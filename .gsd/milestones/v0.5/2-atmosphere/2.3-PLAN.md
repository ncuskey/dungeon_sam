---
phase: 2-atmosphere
plan: 3
wave: 2
---

# Plan 2.3: Ambient Music & Polish

## Objective
Add oppressive ambient drone music and UI controls. Complete the Deathkeep-inspired audio atmosphere.

## Context
- .gsd/phases/2-atmosphere/2.2-PLAN.md (prerequisite)
- src/audio/SoundManager.ts
- src/components/GameOverlay.tsx

## Tasks

<task type="auto">
  <name>Generate ambient drone track</name>
  <files>public/audio/music/dungeon_drone.mp3</files>
  <action>
    Create 2-3 minute looping ambient track:
    - Low drone/sustained bass tones
    - Dissonant, unresolved harmony
    - No rhythm or tempo
    - Occasional subtle swells
    - Think: early dark ambient, dungeon reverb, industrial horror
    
    Use AI music generator or layer simple oscillator tones
    Export as MP3, ensure clean loop point
  </action>
  <verify>Audio file plays and loops smoothly in browser</verify>
  <done>dungeon_drone.mp3 exists and loops without audible gap</done>
</task>

<task type="auto">
  <name>Implement BGM system</name>
  <files>src/audio/SoundManager.ts</files>
  <action>
    Add BGM functionality:
    1. Create Howl for dungeon_drone.mp3 with loop: true
    2. playBGM(): fade in over 2 seconds
    3. stopBGM(): fade out over 1 second
    4. Default music volume 0.4 (quieter than SFX)
    
    BGM should feel like background - players hyper-aware of silence and SFX
  </action>
  <verify>Call soundManager.playBGM(), music loops continuously</verify>
  <done>BGM plays, loops, and can be stopped with fade</done>
</task>

<task type="auto">
  <name>Trigger BGM on game phases</name>
  <files>src/store/gameStore.ts</files>
  <action>
    Wire BGM to game lifecycle:
    - startGame: playBGM()
    - resetGame: playBGM() 
    - phase 'WON' or 'GAME_OVER': stopBGM()
    
    Music should start when gameplay begins, stop on terminal states
  </action>
  <verify>Start game -> music plays. Win/die -> music stops.</verify>
  <done>BGM correctly follows game phase transitions</done>
</task>

<task type="auto">
  <name>Add audio UI toggle</name>
  <files>src/components/GameOverlay.tsx</files>
  <action>
    Add mute button to gameplay HUD:
    - Sound icon in bottom-right corner
    - onClick toggles mute via useAudio hook
    - Visual indicator for muted state (crossed out icon)
    - Minimal styling, semi-transparent
  </action>
  <verify>Click mute button, sound stops. Click again, sound resumes.</verify>
  <done>Functional mute toggle visible during gameplay</done>
</task>

## Success Criteria
- [ ] Ambient drone plays during gameplay
- [ ] Music stops on win/game over
- [ ] Mute button works correctly
- [ ] SFX noticeably louder than music
