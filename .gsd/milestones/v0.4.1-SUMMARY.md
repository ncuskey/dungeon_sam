# Milestone: v0.4.1 (Repair & Polish)

## Completed: 2026-02-05

## Deliverables
- ✅ **Potion Fixes**: Fixed `onTouchStart` interference with `onPointerDown` and added keyboard hotkeys ('H' and '1').
- ✅ **Minimap Fix**: Refactored exploration state to use atomic `get().revealMap()` calls after movement, ensuring reliable discovery.
- ✅ **Light Sync**: Increased camera lerp speed (10 -> 15) for snappier tracking.
- ✅ **Combat Pacing**: Implemented 0.5s attack cooldown in the store to prevent spamming.

## Phases Completed
1. **Phase 1: Engine Repairs** (State & Sync) — 2025-02-06
2. **Phase 2: UX Polish** (Combat & Controls) — 2025-02-06

## Metrics
- **Total commits**: 2 (Planning + Execution)
- **Files changed**: `gameStore.ts`, `CameraRig.tsx`, `PlayerController.tsx`, `TouchControls.tsx`.

## Lessons Learned
- **Zustand Action Chaining**: Calling an action that triggers a `set` inside another `set` return object can lead to race conditions or lost state. Using `get().action()` after a `set()` call is much safer for dependent state updates like map exploration.
- **Pointer Events**: `onPointerDown` is more reliable than `onTouchStart` for cross-platform React apps, especially when `e.preventDefault()` is needed to block browser gestures.
- **State Atomicity**: Movement and map reveal must happen sequentially but reliably to ensure the UI stays in sync.
