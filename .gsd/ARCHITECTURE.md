# Architecture

> Auto-generated by /map on 2026-02-02

## Overview

**Dungeon Sam** is a first-person dungeon crawler built with React, Three.js (via React Three Fiber), and Zustand for state management. It features a retro aesthetic with procedural dungeon generation and dynamic lighting.

```
┌─────────────────────────────────────────┐
│               main.tsx                  │
├─────────────────────────────────────────┤
│                App.tsx                  │
│  ┌──────────────────┐ ┌──────────────┐  │
│  │    GameCanvas    │ │  Overlays    │  │
│  │ (3D Rendering)   │ │ (HUD/Touch)  │  │
│  └────────┬─────────┘ └──────┬───────┘  │
└───────────│──────────────────│──────────┘
            ▼                  ▼
┌─────────────────────────────────────────┐
│              Game Store                 │
│         (Zustand State Machine)         │
├─────────────────────────────────────────┤
│  • Map Data    • Player State           │
│  • Entities    • Game Logic (Tick)      │
└─────────────────────────────────────────┘
            │
            ▼
┌─────────────────────────────────────────┐
│            Utils & Systems              │
├─────────────────────────────────────────┤
│ • Dungeon Gen   • Audio Engine          │
│ • Texture Gen   • AI (A* Pathing)       │
└─────────────────────────────────────────┘
```

## Components

### Core
- **App.tsx**: Main layout, orchestrates Canvas and UI overlays.
- **GameCanvas.tsx**: R3F Canvas setup, CameraRig, and Lights.
- **PlayerController.tsx**: Keyboard input handler (WASD/Arrows).
- **useGameLoop.ts**: Hook that drives the `tickGame` state update at 60fps.

### Rendering
- **LevelRenderer.tsx**: Generates 3D mesh for walls/floor/ceiling from map data. Adds PointLights.
- **EnemyRenderer.tsx**: Renders enemies as billboards.
- **ItemRenderer.tsx**: Renders items (weapons/potions) as billboards.
- **Billboard.tsx**: Reusable component for sprite rendering (always faces camera).

### UI
- **HUD.tsx**: Retro status bar (Health, Equipment).
- **TouchControls.tsx**: Mobile D-Pad and Action buttons.
- **GameOverlay.tsx**: Start Screen, Game Over, Victory screens.

### State & Logic
- **gameStore.ts**: Central source of truth. Handles movement, combat, interaction, and time-stepping.
- **dungeonGenerator.ts**: Procedural Cellular Automata algorithm for map creation.
- **audioIntegration.ts**: Web Audio API procedural sound engine (Drones/SFX).

## Data Flow

1. **Input**: User presses Key/Touch -> Calls Store Action (e.g., `moveForward`).
2. **Logic**: Store checks validity (collision/state) -> Updates State (Position/Phase).
3. **Loop**: `useGameLoop` calls `tickGame` -> Updates AI/Physics.
4. **Render**: Components subscribe to Store State -> Update 3D Scene/DOM.

## Technical Debt

- [ ] **Unused Dependency**: `howler` is installed but replaced by native Web Audio API.
- [ ] **Performance**: React components re-render on state changes; ensure `useGameStore` selectors are optimized.
- [ ] **Cleanup**: `dummyItems` generation logic inside `gameStore` should move to `dungeonGenerator`.

## Conventions

- **State**: Single Zstand store (`useGameStore`).
- **Styling**: `index.css` for global, inline styles for UI (MVP approach).
- **Coordinate System**: Grid based (x, y integers). 3D transformation `x * CELL_SIZE`.
